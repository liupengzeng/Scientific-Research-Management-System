# 科研管理系统精简重构开发文档

## 1. 重构目标
- 数据库核心业务表按**7-9个字段**精简设计，降低维护成本。
- 业务逻辑严格采用四级角色模型：**教师、教研组长、教研处、院校领导**。
- 核心能力保持：**审批关联、权限管理、基础 CRUD**。

## 2. 精简数据模型（7-9 字段）

### 2.1 项目主表 `research_project_core`（9字段）
1. `project_id`：主键
2. `project_no`：项目编号
3. `project_name`：项目名称
4. `applicant_id`：申请人（教师）
5. `dept_id`：归属部门
6. `total_budget`：申请经费
7. `project_status`：项目状态（draft/submitted/approved/rejected）
8. `current_step`：当前审批节点（1/2/3）
9. `create_time`：创建时间

### 2.2 审批记录表 `research_project_approval_core`（9字段）
1. `approval_id`：主键
2. `project_id`：项目ID
3. `step_no`：审批步骤（1组长/2教研处/3院校领导）
4. `approver_id`：审批人ID
5. `approver_role`：审批角色
6. `decision`：审批结果（approve/reject）
7. `comment`：审批意见
8. `final_flag`：是否最终审批
9. `create_time`：审批时间

## 3. 角色与权限模型

| 角色 | role_key | 核心权限 |
|---|---|---|
| 教师 | `teacher` | 项目新增、编辑、提交、查看本人数据 |
| 教研组长 | `research_group_leader` | 一级审批 |
| 教研处 | `research_office` | 二级审批 |
| 院校领导 | `college_leader` | 终审 |

## 4. 审批关联核心流程
1. 教师提交项目：状态从 `draft -> submitted`，`current_step = 1`。
2. 教研组长审批：
   - 通过：`current_step = 2`
   - 驳回：状态回退 `draft`，流程结束
3. 教研处审批：
   - 通过：`current_step = 3`
   - 驳回：状态回退 `draft`，流程结束
4. 院校领导终审：
   - 通过：状态 `approved`，`final_flag = 1`
   - 驳回：状态回退 `draft`，`final_flag = 1`

> 审批记录与项目状态必须保持事务一致。

## 5. CRUD 范围
- 项目：新增、查询、修改、删除、提交。
- 审批记录：按项目查询（禁止物理删除）。
- 用户与角色：基础维护与角色分配。

## 6. 落地约束
- 不允许教师执行审批。
- 非当前节点角色不可越级审批。
- 任一节点被驳回后，流程回到草稿，需要教师重新提交。
