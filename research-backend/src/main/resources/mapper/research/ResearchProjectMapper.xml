<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.university.research.research.mapper.ResearchProjectMapper">

    <resultMap id="ProjectResult" type="com.university.research.research.domain.ResearchProject">
        <id property="projectId" column="project_id"/>
        <result property="projectNo" column="project_no"/>
        <result property="projectName" column="project_name"/>
        <result property="projectTypeId" column="project_type_id"/>
        <result property="leaderId" column="leader_id"/>
        <result property="deptId" column="dept_id"/>
        <result property="sourceUnit" column="source_unit"/>
        <result property="projectLevel" column="project_level"/>
        <result property="totalBudget" column="total_budget"/>
        <result property="approvedAmount" column="approved_amount"/>
        <result property="startDate" column="start_date"/>
        <result property="endDate" column="end_date"/>
        <result property="duration" column="duration"/>
        <result property="projectStatus" column="project_status"/>
        <result property="keywords" column="keywords"/>
        <result property="researchContent" column="research_content"/>
        <result property="expectedResult" column="expected_result"/>
        <result property="currentProgress" column="current_progress"/>
        <result property="approvalDocNo" column="approval_doc_no"/>
        <result property="approvalDate" column="approval_date"/>
        <result property="remark" column="remark"/>
        <result property="createBy" column="create_by"/>
        <result property="createTime" column="create_time"/>
        <result property="updateBy" column="update_by"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <sql id="columns">
        project_id, project_no, project_name, project_type_id, leader_id, dept_id, source_unit, project_level,
        total_budget, approved_amount, start_date, end_date, duration, project_status, keywords, research_content,
        expected_result, current_progress, approval_doc_no, approval_date, remark, create_by, create_time, update_by, update_time
    </sql>

    <select id="selectProjectList" resultMap="ProjectResult">
        select
        <include refid="columns"/>
        from research_project
        <where>
            <if test="p != null">
                <if test="p.projectName != null and p.projectName != ''">
                    and project_name like concat('%', #{p.projectName}, '%')
                </if>
                <if test="p.projectTypeId != null">
                    and project_type_id = #{p.projectTypeId}
                </if>
                <if test="p.leaderId != null">
                    and leader_id = #{p.leaderId}
                </if>
                <if test="p.deptId != null">
                    and dept_id = #{p.deptId}
                </if>
                <if test="p.projectStatus != null and p.projectStatus != ''">
                    and project_status = #{p.projectStatus}
                </if>
                <if test="p.beginDate != null">
                    and start_date &gt;= #{p.beginDate}
                </if>
                <if test="p.endDateQuery != null">
                    and end_date &lt;= #{p.endDateQuery}
                </if>
            </if>
        </where>
        order by create_time desc, project_id desc
    </select>

</mapper>

